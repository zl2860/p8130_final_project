---
title: "Final Project"
author: "Clement Mugenzi"
date: "12/6/2019"
output: github_document
---

```{r setup, include=FALSE}
library(MASS)
library(dplyr)
library(tidyverse)
library(knitr)
library(broom)
library(faraway)
library(arsenal)
library(caret)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "right"))
```

# Introduction 

  Title VII of the Civil Rights Act of 1964 is a federal law that prohibits employers from discriminating against employees on the basis of sex, race, color, national origin and religion. Also, the equal pay act of 1963 requires that men and women in the same workplace be given equal pay for equal work. Income inequality between men and women who do the same work have been a point of debate over the years and efforts have been made to ensure women receive the same remuneration as men for doing equal work. While there have been several studies conducted about the income gap between both gender, it is almost impossible to find a single study that focuses on one profession or industry.
  
  The U.S education system is one area that is not immune to this income gap problem. Several factors determines ones compansation in the education system such as the area of expertise, years of experience, title, the amount of research papers published, etc. Despite these legitimate factors that determines compansation, there are many cases that have been published claiming that female professors are getting paid less compared to their male colleagues while bearing the same, if not superior, titles and accolades. 
  
  The aim of this study is to examine the association between gender discrimination in setting salary within the Houston college of medicine where a female professor claimed, through a discrict court lawsuit, that there was evidence of discrimination against women in giving promotions and setting salaries.  
  
  


# Methods

## Data Description and Statistical Methods

* Dept: Academic departments at Houston College of medicine. Biochemistry, Physiology, Genetics, Pediatrics, Medicine, and Surgery
* Gender: A dichotomous variable coded with dummy variables '1' for Male subjects and '0' for Female subjects
* Clin: A dummy variable with 1 = Primarily clinnical emphasis and 0 = Primarily research emphasis.
* Cert: 1 = Board certified and 0 = not certified
* Prate: Publication rate 
* Exper: years of experience since obtaining Medical Doctor degree.
* Rank: 1 = Assistant professor, 2 = Associate professor, 3 = full professor
* Sal94: Salary in academic year 1994
* Sal05: Salary in academic year 1995.

The goal of this project is to investigate if claims made by a university's professor that there is gender discrimination when it comes to salary are true by building different multiple regression models and selecting the best and optimized model.

# Loading and cleaning the dataset

```{r, include=TRUE, message = FALSE, warning = FALSE}
lawsuit_df =
  read_csv("Lawsuit.csv") %>% 
  janitor::clean_names() %>%
  dplyr::mutate(
    dept = factor(dept, levels = c("1", "2", "3",
                                   "4", "5", "6")),
    gender = factor(gender, levels = c("1", "0")),
    clin = factor(clin, levels = c("1", "0")),
    cert = factor(cert, levels = c("1", "0")),
    rank = factor(rank, levels = c("1", "2", "3"))) %>% 
  mutate(
    gender = recode(gender, "1" = "Male", "0" = "Female"),
    dept = recode(dept, "1" = "Biochemistry", "2" = "Physiology", "3" = "Genetics",
                  "4" = "Pediatrics", "5" = "Medicine", "6" = "Surgery"),
    clin = recode(clin, "1" = "clinical", "0" = "research"),
    cert = recode(cert, "1" = "certified", "0" = "Not certified"),
    rank = recode(rank, "1" = "assistant", "2" = "associate", "3" = "full")) %>%
  arrange(gender)
```

**Descriptive Statistics:**

```{r, results='asis', include=TRUE, message = FALSE, warning = FALSE}
# Cleaning output
tab1_controls = tableby.control(
               total = T,
               test = F,
               numeric.stats = c("meansd", "medianq1q3", "range"),
               cat.stats = "countpct",
               stats.labels = list(
               meansd = "Mean (SD)",
               medianq1q3 = "Median (Q1, Q3)",
               range = "Min - Max",
               countpct = "N (%)"))

tab1 = tableby(gender ~ dept + clin + cert + prate +
                  exper + rank + sal94 + sal95,
                data = lawsuit_df, control = tab1_controls)
summary(tab1, title = 'Descriptive Statistics', digits = 2, text = T)
```

**Exploring the distribution of the response variable:**

Let's first look at the distribution of salaries in the year 1994:

```{r}
lawsuit_df %>% 
  ggplot(aes(x = sal94)) + 
  geom_histogram(fill = "gray50") +
  labs(
    x = "Untransformed Salary (1994)")
```

The salary histogram in the year 1994 exhibits right skewness which means I will try a different transformation.

**Log-Transformation of 1994 salary and its distribution:**

```{r}
lawsuit_df = 
  lawsuit_df %>% 
  mutate(log_sal94 = log(sal94))

lawsuit_df %>% 
  ggplot(aes(x = log_sal94)) + 
  geom_histogram(fill = "gray50") +
  labs(
    x = "Log_Transformed Salary (1994)")
```


Second, let's look at the distribution of salaries in the year 1995:

```{r}
lawsuit_df %>% 
  ggplot(aes(x = sal95)) + 
  geom_histogram(fill = "gray50") +
  labs(
    x = "Untransformed Salary (1995)")
```

This histogram also seem to exhibit right skewness, therefore it is worth transforming.

**Log-Transformation of 1994 salary and its distribution:**

```{r}
lawsuit_df = 
  lawsuit_df %>% 
  mutate(log_sal95 = log(sal95))

write.csv(lawsuit_df, "lawsuit_df.csv")

lawsuit_df %>%
  ggplot(aes(x = log_sal95)) + 
  geom_histogram(fill = "gray50") +
  labs(
    x = "Log_Transformed Salary (1995)")
```



let's try looking at scatter plot to identify linearity between covariates and covariate-response relationships.

```{r}
lawsuit_df %>% 
  select(-c(id, sal94, sal95)) %>% 
  pairs(gap = 0)
```

Based on the above scatterplot matrix, the use of the MLR is justified due to the linear trend in the graphs of both salaries (1994 and 1995) against department, Publication rates, years of experience. Let's now investigate the correlation of continuous predictors in the matrix below. 

```{r}
lawsuit_df %>% 
  dplyr::select(prate, exper, log_sal94, log_sal95) %>% 
  cor() %>% kable()
```

The correlation matrix does not indicate strong correlation between continuous variables except for the high correlation between both salaries (1994 and 1995)



## Model Building and checking for interactions

**Interactions: Graphical**

We will check possible interaction existing between the gender variable and other predictor veriable since we are mainly interested in the relationship between gender and the 1994 salary.


```{r}
mlr_94 = lm(log_sal94 ~ gender, data = lawsuit_df)
summary(mlr_94)
```

Let us include the interaction term in the model. The gender variable was tested against the rest of the categorical variables (department, clin, cert, prate, exper, and rank). 

The estimated regression equation that includes the interaction term is given by:

$$\hat{Y}=\hat\beta_1X_{gender}+\hat\beta_2X_{rank}+\hat\beta_3X_{gender}*X_{rank}+\hat\beta_0$$

**Hypothesis Testing:**

$$H_0:\hat\beta_3=0$$
$$H_1:\hat\beta_3\ne0$$


```{r}
mlr_int = lm(log_sal94 ~ gender * rank, data = lawsuit_df)
summary(mlr_int)
```

All but rank was found to be an effect modifier of the relationship between gender and the 1994 salary. Specifically, we found that female subjects with titles *"Full Professor"* were an effect modifier in the relationship between gender and the 1994 salary.









using graphical representation, we examined the relationship between the gender variable with both publication rate and years of experience and found no interaction as seen in the parallel lines generated in both graphs.


```{r}
lawsuit_df %>% 
  ggplot(aes(x = exper, y = log_sal94, color = gender)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE)
```

With a graphical display, it is evident that gender is not an effect modifier in the relationship between years of experience and the 1994 salary.


```{r}
lawsuit_df %>% 
  ggplot(aes(x = prate, y = log_sal94, color = gender)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE)
```

Again with a graphical display, it is evident that gender is not an effect modifier in the relationship between the rate of publishing research papers and the 1994 salary.

**The Best Model Possible:**

```{r}
ult_mod = lm(log_sal94 ~ dept + exper + clin + cert + rank
             , data = lawsuit_df)
summary(ult_mod)
```